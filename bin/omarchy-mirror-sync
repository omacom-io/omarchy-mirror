#!/bin/bash

# Enable execution of subscripts
SCRIPT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"

while [[ $# -gt 0 ]]; do
  case $1 in
  --upstream)
    UPSTREAM="$2"
    shift 2
    ;;
  --stage)
    STAGE="$2"
    shift 2
    ;;
  --r2)
    R2="$2"
    shift 2
    ;;
  --verbose)
    VERBOSE=true
    shift
    ;;
  *)
    echo "Unknown option: $1"
    echo "Usage: $0 [--upstream UPSTREAM] [--stage STAGE] [--r2 R2] [--verbose]"
    exit 1
    ;;
  esac
done

echo "Start syncing Omarchy mirror"

"$SCRIPT_DIR/omarchy-mirror-stage --upstream $UPSTREAM --stage $STAGE"
"$SCRIPT_DIR/omarchy-mirror-upload --stage $STAGE --r2 $R2"

echo "Finished syncing Omarchy mirror in ${SECONDS}s"
